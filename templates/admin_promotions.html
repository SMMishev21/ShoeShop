{% extends "base.html" %}
{% block content %}
<div class="admin-container">
    <h1>üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ü—Ä–æ–º–æ—Ü–∏–∏</h1>
    
    <div class="admin-actions">
        <a href="{{ url_for('promotion.add_promotion') }}" class="btn btn-primary">
            ‚ûï –î–æ–±–∞–≤–∏ –Ω–æ–≤–∞ –ø—Ä–æ–º–æ—Ü–∏—è
        </a>
        <a href="{{ url_for('admin.products') }}" class="btn btn-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –∫—ä–º –ø—Ä–æ–¥—É–∫—Ç–∏
        </a>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ó–∞–≥–ª–∞–≤–∏–µ</th>
                    <th>–ü—Ä–æ–º–æ –∫–æ–¥</th>
                    <th>–û—Ç—Å—Ç—ä–ø–∫–∞</th>
                    <th>–ù–∞—á–∞–ª–æ</th>
                    <th>–ö—Ä–∞–π</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for promo in promotions %}
                <tr>
                    <td>{{ promo.id }}</td>
                    <td>
                        <strong>{{ promo.title }}</strong>
                        {% if promo.description %}
                        <br><small style="color: #7f8c8d;">{{ promo.description[:50] }}{% if promo.description|length > 50 %}...{% endif %}</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if promo.promo_code %}
                        <code style="background: #f8f9fa; padding: 2px 6px; border-radius: 4px;">{{ promo.promo_code }}</code>
                        {% else %}
                        <em>–ë–µ–∑ –∫–æ–¥</em>
                        {% endif %}
                    </td>
                    <td>
                        <span class="discount-badge">-{{ promo.discount_percent|round|int }}%</span>
                    </td>
                    <td>
                        <small>{{ promo.start_date }}</small>
                    </td>
                    <td>
                        <small>{{ promo.end_date }}</small>
                    </td>
                    <td>
                        {# Simple status logic - always show based on is_active flag #}
                        {% if promo.is_active %}
                            {% if "2024" in promo.end_date or "2025" in promo.end_date %}
                                <span class="status-badge active">üü¢ –ê–∫—Ç–∏–≤–Ω–∞</span>
                            {% else %}
                                <span class="status-badge expired">üî¥ –ò–∑—Ç–µ–∫–ª–∞</span>
                            {% endif %}
                        {% else %}
                            <span class="status-badge inactive">‚ö´ –ù–µ–∞–∫—Ç–∏–≤–Ω–∞</span>
                        {% endif %}
                    </td>
                    <td class="actions">
                        <a href="{{ url_for('promotion.edit_promotion', promotion_id=promo.id) }}" class="btn-edit">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π
                        </a>
                        <a href="{{ url_for('promotion.delete_promotion', promotion_id=promo.id) }}"
                           class="btn-delete"
                           onclick="return confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ –ø—Ä–æ–º–æ—Ü–∏—è—Ç–∞ \"{{ promo.title }}\"?')">
                            üóëÔ∏è –ò–∑—Ç—Ä–∏–π
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" style="text-align: center; padding: 40px;">
                        <div class="empty-state">
                            <h3>üì≠ –í—Å–µ –æ—â–µ –Ω—è–º–∞ –ø—Ä–æ–º–æ—Ü–∏–∏</h3>
                            <p>–°—ä–∑–¥–∞–π—Ç–µ –ø—ä—Ä–≤–∞—Ç–∞ –ø—Ä–æ–º–æ—Ü–∏—è, –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ –¥–∞ –ø—Ä–∏–≤–ª–∏—á–∞—Ç–µ –∫–ª–∏–µ–Ω—Ç–∏!</p>
                            <a href="{{ url_for('promotion.add_promotion') }}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏ –ø—Ä–æ–º–æ—Ü–∏—è</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ promotions|length }}</div>
            <div class="stat-label">–û–±—â–æ –ø—Ä–æ–º–æ—Ü–∏–∏</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">
                {{ promotions|selectattr('is_active')|list|length }}
            </div>
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω–∏ –ø—Ä–æ–º–æ—Ü–∏–∏</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">
                {# Count promotions that are likely active based on year #}
                {% set active_count = 0 %}
                {% for promo in promotions %}
                    {% if promo.is_active and ("2024" in promo.end_date or "2025" in promo.end_date) %}
                        {% set active_count = active_count + 1 %}
                    {% endif %}
                {% endfor %}
                {{ active_count }}
            </div>
            <div class="stat-label">–í –º–æ–º–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∏</div>
        </div>
    </div>
</div>

<style>
.discount-badge {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: bold;
    font-size: 0.9rem;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: bold;
}

.status-badge.active {
    background: #d4edda;
    color: #155724;
}

.status-badge.upcoming {
    background: #fff3cd;
    color: #856404;
}

.status-badge.expired {
    background: #f8d7da;
    color: #721c24;
}

.status-badge.inactive {
    background: #e2e3e5;
    color: #383d41;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 4px solid #3498db;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 8px;
}

.stat-label {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.empty-state {
    text-align: center;
    padding: 20px;
}

.empty-state h3 {
    color: #7f8c8d;
    margin-bottom: 10px;
}

.empty-state p {
    color: #95a5a6;
    margin-bottom: 20px;
}
</style>
{% endblock %}